<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Expositor - Agropec 2025</title>

  <!-- Meta Tags Open Graph para preview em redes sociais (WhatsApp, Facebook, etc.) -->
  <meta property="og:title" content="Cadastro de Expositor - Agropec 2025">
  <meta property="og:description" content="Preencha o formulário para cadastrar sua empresa na Agropec 2025 e faça parte do evento!">
  <meta property="og:image" content="https://i.postimg.cc/xqrqcZbt/logo-agropec.png"> <!-- Use a URL da sua imagem de preview aqui -->
  <meta property="og:url" content="https://gabriellopes23.github.io/CadastroAgropec/"> <!-- Use a URL final do seu site aqui -->
  <meta property="og:type" content="website">
  <!-- Fim das Meta Tags Open Graph -->

  <!-- Importação da fonte Montserrat do Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <!-- Fim da importação da fonte -->

  <style>
    /* Cores da paleta Agropec */
    :root {
      --bg-dark-green: #1E4844;
      --input-bg-dark-green: #2E6E65;
      --border-dark-green: #1B3F3B;
      --button-green: #3AAFA9;
      --button-hover-green: #2c8b87;
      --text-white: white;
      --placeholder-color: #b3d2cd;
      --error-color: #ff6b6b;
      --error-bg: #2c1515;
      --success-color: #51cf66;
      --success-bg: #1a2e1a;
      --loading-color: #ffd43b;
      --loading-bg: #2e2a1a;
      --card-bg: white; /* Cor de fundo do card principal */
      --card-text-color: #333; /* Cor do texto dentro do card */
      --input-line-color: #ccc; /* Cor da linha dos inputs */
      --input-focus-color: #3AAFA9; /* Cor da linha dos inputs ao focar */
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--bg-dark-green );
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh; /* Ocupa a altura total da viewport */
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }

    .form-container {
      background-color: var(--card-bg);
      color: var(--card-text-color);
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      max-width: 500px; /* Ajuste a largura máxima do card */
      width: 100%;
      box-sizing: border-box;
      position: relative; /* Para posicionar o X de fechar se necessário */
    }

    h1 {
      text-align: center;
      color: var(--card-text-color);
      font-size: 1.8rem;
      margin-bottom: 20px;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo-container img {
      max-width: 180px; /* Ajuste o tamanho da logo dentro do card */
      height: auto;
      display: inline-block;
      margin-bottom: 10px;
    }

    /* Linha decorativa abaixo da logo */
    .logo-container::after {
      content: '';
      display: block;
      width: 60px;
      height: 2px;
      background-color: var(--button-green);
      margin: 10px auto 30px auto;
      border-radius: 2px;
    }

    label {
      font-weight: bold;
      margin-top: 20px; /* Mais espaço acima das labels */
      margin-bottom: 5px; /* Espaço abaixo das labels */
      display: block;
      color: var(--card-text-color);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input[type="text"],
    textarea,
    input[type="file"] {
      width: 100%;
      padding: 8px 0; /* Padding vertical */
      border: none;
      border-bottom: 1px solid var(--input-line-color); /* Linha inferior */
      background-color: transparent; /* Fundo transparente */
      color: var(--card-text-color);
      font-size: 1rem;
      margin-top: 0; /* Remove margin-top padrão */
      margin-bottom: 20px; /* Espaço abaixo do input */
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus,
    textarea:focus,
    input[type="file"]:focus {
      outline: none;
      border-bottom-color: var(--input-focus-color); /* Cor da linha ao focar */
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--placeholder-color);
    }

    /* Estilos para o select (com a seta) */
    select {
      width: 100%;
      padding: 8px 0;
      border: none;
      border-bottom: 1px solid var(--input-line-color);
      background-color: transparent;
      color: var(--card-text-color);
      font-size: 1rem;
      margin-top: 0;
      margin-bottom: 20px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20256%20256%22%3E%3Cpath%20fill%3D%22%23333%22%20d%3D%22M208.5%2096.5L128%20177l-80.5-80.5z%22%2F%3E%3C%2Fsvg%3E' ); /* Seta preta para fundo branco */
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 1em;
      padding-right: 2em;
      border-radius: 0; /* Remove border-radius para alinhar com a linha */
    }

    select option {
        background-color: var(--card-bg); /* Cor de fundo das opções */
        color: var(--card-text-color); /* Cor do texto das opções */
    }

    /* Estilos para os botões de adicionar/remover */
    button {
      background-color: var(--button-green);
      color: var(--text-white);
      font-weight: bold;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
      border-radius: 4px;
      padding: 8px 12px;
      width: auto; /* Para botões de adicionar/remover */
    }

    button:hover {
      background-color: var(--button-hover-green);
    }

    /* Estilo para os itens de produto e programação (para alinhar input e botão) */
    .produto-item,
    .programacao-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .produto-item input,
    .programacao-item input {
      flex-grow: 1;
      margin-top: 0;
      margin-bottom: 0; /* Remove margin-bottom para alinhar */
    }

    .produto-item button,
    .programacao-item button {
      flex-shrink: 0;
      margin-top: 0;
    }

    h3 {
      color: var(--card-text-color);
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    /* Estilo para o botão Enviar Tudo */
    .btn-enviar {
      width: 100%; /* Ocupa a largura total */
      margin-top: 40px; /* Mais espaço acima */
      padding: 15px 25px;
      font-size: 1.2rem;
      border-radius: 8px;
      background-color: var(--button-green); /* Cor principal */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .btn-enviar:hover {
      background-color: var(--button-hover-green);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .status {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      border-radius: 4px;
    }

    .error {
      color: var(--error-color);
      background-color: var(--error-bg);
    }

    .success {
      color: var(--success-color);
      background-color: var(--success-bg);
    }

    .loading {
      color: var(--loading-color);
      background-color: var(--loading-bg);
    }
  </style>
</head>

<body>
  <div class="form-container">
    <div class="logo-container">
      <!-- https://i.postimg.cc/xqrqcZbt/logo-agropec.png -->
      <img src="https://i.postimg.cc/D0r7ZyC5/LOGO-AGROPEC-VERDE2.png" alt="Logo Agropec">
    </div>

    <h1>Cadastro de Expositor</h1>
    <!-- Removido o texto de introdução para um visual mais limpo -->

    <label for="empresaNome">Nome da Empresa:</label>
    <input type="text" id="empresaNome" placeholder="Agro Cangaia">

    <label for="empresaDesc">Descrição:</label>
    <textarea id="empresaDesc" rows="4" placeholder="Descrição da empresa"></textarea>

    <label for="empresaTipo">Tipo:</label>
    <select id="empresaTipo">
      <option value="">Selecione o Tipo</option>
      <option value="AGRICULTURA">AGRICULTURA</option>
      <option value="TECNOLOGIA">TECNOLOGIA</option>
      <option value="PECUARIA">PECUARIA</option>
      <option value="BELEZA">BELEZA</option>
      <option value="ALIMENTACAO">ALIMENTACAO</option>
      <option value="MAQUINAS">MAQUINAS</option>
      <option value="ARTESANATO">ARTESANATO</option>
      <option value="MINERACAO">MINERACAO</option>
    </select>

    <label for="logoInput">Logo:</label>
    <input type="file" id="logoInput" accept="image/*">

    <label for="bannerInput">Banner:</label>
    <input type="file" id="bannerInput" accept="image/*">

    <label>Produtos / Serviços</label>
    <div id="produtosContainer">
      <!-- Inputs serão adicionados aqui ao clicar -->
    </div>
    <button type="button" onclick="adicionarProduto( )">Adicionar Produto / Serviço</button>

    <h3>Programações</h3>
    <div id="programacoesContainer" class="programacoes-container">
      <!-- Programações dinâmicas serão inseridas aqui -->
    </div>
    <button type="button" onclick="adicionarProgramacao()">Adicionar Programação</button>

    <button type="button" onclick="enviar()" class="btn-enviar">Enviar Tudo</button>

    <div id="status" class="status"></div>
  </div>

  <script>
    const BASE_URL = 'https://4n2wbzfpwjhw7boo2eak3caehy0hylmz.lambda-url.sa-east-1.on.aws';
    const uploadImageUrl = `${BASE_URL}?action=uploadImage`; // URL para upload de imagens
    const saveExhibitorUrl = `${BASE_URL}?action=saveExpositor`; // URL para salvar o content.json

    function adicionarProduto( ) {
      const container = document.getElementById("produtosContainer");
      const div = document.createElement("div");
      div.className = 'produto-item'; // Adiciona a classe para estilização
      div.innerHTML = `
        <input type="file" accept="image/*" class="produtoInput">
        <button type="button" onclick="this.parentElement.remove()">Remover</button>
      `;
      container.appendChild(div);
    }

    function adicionarProgramacao() {
      const container = document.getElementById("programacoesContainer");
      const div = document.createElement("div");
      div.className = 'programacao-item'; // Adiciona a classe para estilização
      div.innerHTML = `
        <input type="text" placeholder="Horário (ex: 9.00)" class="programacaoHorario" required>
        <input type="text" placeholder="Título da Programação" class="programacaoTitulo" required>
        <button type="button" onclick="this.parentElement.remove()">Remover</button>
      `;
      container.appendChild(div);
    }

    function showStatus(message, type = 'loading') {
      const div = document.getElementById("status");
      div.className = type;
      div.innerText = message;
    }

    // Função para enviar arquivos (imagens) usando o cabeçalho 'filename'
    async function enviarArquivoParaLambdaOriginal(file, fileNameWithFolder) {
      const url = uploadImageUrl; // A URL já tem a action=uploadImage

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': file.type, // O tipo do arquivo (image/png, image/jpeg, etc.)
          'filename': fileNameWithFolder // <--- O NOME DO ARQUIVO COM A PASTA (Ex: Exhibitors/empresaId/logo.png)
        },
        body: file // O conteúdo binário do arquivo
      });

      const text = await response.text();
      if (!response.ok) throw new Error(`Erro no upload de ${fileNameWithFolder}: ${text}`);

      try {
        return JSON.parse(text);
      } catch {
        return { message: text };
      }
    }

    // Função para enviar o JSON do expositor (o Lambda original gera o timestamp e a pasta)
    async function enviarJsonParaLambdaOriginal(payload) {
      const url = saveExhibitorUrl; // A URL já tem a action=saveExpositor

      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const text = await response.text();
      if (!response.ok) throw new Error(`Erro no envio JSON: ${text}`);
      return JSON.parse(text);
    }

    async function enviar() {
  try {
    const empresaNome = document.getElementById("empresaNome").value.trim();
    const empresaDesc = document.getElementById("empresaDesc").value.trim();
    const empresaTipo = document.getElementById("empresaTipo").value.trim(); // Pega o valor do select

    if (!empresaNome || !empresaDesc || !empresaTipo) { // Adicionado empresaTipo na validação
      showStatus("❌ Preencha todos os campos obrigatórios.", 'error');
      return;
    }

    const empresaId = empresaNome.toLowerCase().replace(/\s/g, "");
    const uploadPromises = [];
    const produtosNomes = [];

    const logoFile = document.getElementById("logoInput").files[0];
    const bannerFile = document.getElementById("bannerInput").files[0];

    const empresaFolder = `Exhibitors/${empresaId}/`;

    if (logoFile) uploadPromises.push(enviarArquivoParaLambdaOriginal(logoFile, `${empresaFolder}logo.png`));
    if (bannerFile) uploadPromises.push(enviarArquivoParaLambdaOriginal(bannerFile, `${empresaFolder}banner.png`));

    const produtoInputs = document.getElementsByClassName("produtoInput");
    for (let i = 0; i < produtoInputs.length; i++) {
      const file = produtoInputs[i].files[0];
      if (file) {
        const nomeArquivo = `product_${i + 1}.png`;
        produtosNomes.push(nomeArquivo);
        uploadPromises.push(enviarArquivoParaLambdaOriginal(file, `${empresaFolder}${nomeArquivo}`));
      }
    }

    showStatus("📤 Enviando arquivos para o AWS S3...", 'loading');
    const imageUploadResults = await Promise.allSettled(uploadPromises);
    imageUploadResults.forEach((result, index) => {
        if (result.status === 'fulfilled') {
            console.log(`Upload de imagem ${index + 1} SUCESSO:`, result.value);
        } else {
            console.error(`Upload de imagem ${index + 1} FALHA:`, result.reason);
        }
    });


    const horarios = document.getElementsByClassName("programacaoHorario");
    const titulos = document.getElementsByClassName("programacaoTitulo");
    const programacoes = [];

    for (let i = 0; i < horarios.length; i++) {
      const horario = horarios[i].value.trim();
      const titulo = titulos[i].value.trim();
      if (horario && titulo) {
        programacoes.push({ horario, titulo, data: "13/07/2025" });
      }
    }

    const content = {
          nome: empresaNome,
          id: empresaId, // <--- ESTE 'id' SERÁ USADO PELO LAMBDA PARA A PASTA
          estande: {
            nome: empresaNome,
            description: empresaDesc,
            type: empresaTipo, // O valor selecionado do select
            banner: bannerFile ? "banner.png" : null,
            logo: logoFile ? "logo.png" : null,
            programacoes,
            servicos: produtosNomes
          },
          emailContact: null,
          locationLink: null
        };

    console.log("Payload do content.json:", JSON.stringify(content, null, 2));

    showStatus("📄 Enviando dados do expositor (content.json)...", 'loading');
    try {
        const jsonResult = await enviarJsonParaLambdaOriginal(content);
        console.log("Envio do content.json SUCESSO:", jsonResult);
        showStatus("✅ Cadastro enviado com sucesso para o AWS S3!", 'success');
    } catch (jsonError) {
        console.error("Envio do content.json FALHA:", jsonError);
        showStatus(`❌ Erro ao enviar dados do expositor: ${jsonError.message}`, 'error');
    }

  } catch (err) {
    console.error("Erro geral no envio:", err);
    showStatus(`❌ Erro: ${err.message}`, 'error');
  }
}
  </script>
</body>
</html>
